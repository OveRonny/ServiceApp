@page "/vehicle-details/{regnr}"
@using ServiceApp.UI.Services.StatensVegvesenServices
@using System.Globalization
@inject IStatensVegvesenService StatensVegvesenService

@if (vehicleDetails != null)
{
    <div class="container-xxl my-4">
        <div class="row justify-content-center">
            <div class="col-lg-8">

                <div class="card card-service mb-4">
                    <div class="card-body">
                       <h3>@vehicleDetails.Merke @vehicleDetails.Modell</h3>
                        <div class="row">
                            <div class="col-md-6">
                                <h5 class="mb-2">Bil info</h5>
                                <div><strong>Registreringsnummer:</strong> @vehicleDetails.Registreringsnummer</div>                                
                                <div><strong>Årsmodell:</strong> @vehicleDetails.Ar</div>
                                <div><strong>Understellsnummer:</strong> @vehicleDetails.UnderstellsNummer</div>
                                <div><strong>Registrert på eier:</strong> @vehicleDetails.RegistreringEier.ToShortDateString()</div>
                                <div>
                                    <strong class="me-1">Første gang registrert:</strong>
                                    @(DateTime.TryParse(vehicleDetails.ForrsteGangRegistrert, out var dt)
                                                                    ? dt.ToString("dd.MM.yyyy", System.Globalization.CultureInfo.GetCultureInfo("nb-NO"))
                                                                    : "Ikke oppgitt")
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h5 class="mb-2">Periodisk kjørekontroll</h5>
                                <div><strong>Neste kontroll:</strong> 
                                    @(DateTime.TryParse(vehicleDetails.KontrollFrist, out var dateTime) 
                                    ? dateTime.ToString("dd.MM.yyyy", System.Globalization.CultureInfo.GetCultureInfo("nb-NO"))
                                    : "Ikke oppgitt")
                                </div>
                                <div><strong>Sist kontrollert:</strong> 
                                    @(DateTime.TryParse(vehicleDetails.SistGodkjent, out var dat)
                                    ? dat.ToString("dd.MM.yyyy", System.Globalization.CultureInfo.GetCultureInfo("nb-NO"))
                                    : "Ikke oppgitt")
                                </div>
                            </div>
                        </div>
                        <hr />
                        <div class="row">
                            <div class="col-md-6">
                                <h5 class="mb-2">Dekk & felg</h5>
                                <div><strong>Dekkdimensjon:</strong> @vehicleDetails.Dekkdimensjon</div>
                                <div><strong>Innpress:</strong> @vehicleDetails.Innpress</div>
                                <div><strong>FelgDimensjon:</strong> @vehicleDetails.FelgDimensjon</div>
                            </div>
                            <div class="col-md-6">
                                <h5 class="mb-2">Motor og drivverk</h5>
                                <div><strong>Drivstoff:</strong> @vehicleDetails.KodeNavn</div>
                                <div><strong>Motor kode:</strong> @vehicleDetails.MotorKode</div>
                                <div><strong>Girkasse:</strong> @vehicleDetails.GirKasse</div>
                                <div><strong>Hestekrefter:</strong> @vehicleDetails.Hestekrefter</div>
                            </div>
                        </div>
                        <hr />
                        <div>
                            <h5 class="mb-2">Karosseri</h5>
                            <div><strong>FargeNavn:</strong> @vehicleDetails.FargeNavn</div>
                            <div><strong>Farge beskrivelse:</strong> @vehicleDetails.FargeBeskrivelse</div>
                            <div><strong>Farge kode:</strong> @vehicleDetails.FargeKode</div>
                            <div><strong>Lengde:</strong> @vehicleDetails.Lengde</div>
                            <div><strong>Høyde:</strong> @vehicleDetails.Hoyde</div>
                            <div><strong>Bredde:</strong> @vehicleDetails.Bredde</div>
                            <div><strong>Vekt:</strong> @vehicleDetails.Vekt</div>
							<div><strong>Antall dører:</strong> @vehicleDetails.Dorer</div>
                            <div><strong>Antall seter:</strong> @vehicleDetails.Seter</div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
}
else
{
    <p><em>Loading...</em></p>
}

@code {
    [Parameter]
    public string? regnr { get; set; }

    private StatensVegvesenModel? vehicleDetails;

    protected override async Task OnInitializedAsync()
    {
        if (regnr != null)
            vehicleDetails = await StatensVegvesenService.GetVehicleInfo(regnr);
    }
}
